<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FaithCafe - Menu</title>
    <link rel="stylesheet" href="../static/css/style.css">
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="logo">FaithCafe</div>
            <nav>
                <ul>
                    <li><a href="home.html">Home</a></li>
                    <li><a href="menu.html">Menu</a></li>
                    <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
                    <li><a href="status.html">Delivery Status</a></li>
                </ul>
            </nav>
            <button id="theme-toggle" class="theme-toggle">ðŸŒ™</button>
        </div>
    </header>

    <main>
        <div class="container">
            <h1 class="page-title">Our Menu</h1>
            
            <!-- Menu categories will be loaded dynamically -->
            <div id="menu-container">
                <!-- Menu items will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Size Selection Modal -->
    <div id="sizeModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 id="modal-item-name">Select Size</h3>
            <div class="size-options">
                <div class="size-option" data-size="Regular">
                    <input type="radio" id="size-regular" name="size" value="regular" checked>
                    <label for="size-regular">Regular - â‚±<span id="regular-price">49</span></label>
                </div>
                <div class="size-option" data-size="Large">
                    <input type="radio" id="size-large" name="size" value="large">
                    <label for="size-large">Large - â‚±<span id="large-price">59</span></label>
                </div>
            </div>
            <div class="quantity-selector">
                <label for="quantity">Quantity:</label>
                <div class="quantity-controls">
                    <button type="button" class="quantity-btn" onclick="decreaseQuantity()">-</button>
                    <input type="number" id="quantity" value="1" min="1" max="10">
                    <button type="button" class="quantity-btn" onclick="increaseQuantity()">+</button>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addToCartWithSize()">Add to Cart</button>
            </div>
        </div>
    </div>

    <!-- Burger Options Modal -->
    <div id="burgerModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>Burger Options</h3>
            <div class="burger-options">
                <div class="burger-option">
                    <input type="radio" id="burger-plain" name="burger-type" value="plain" checked>
                    <label for="burger-plain">Plain Burger - â‚±35</label>
                </div>
                <div class="burger-option">
                    <input type="radio" id="burger-cheese" name="burger-type" value="cheese">
                    <label for="burger-cheese">Burger with Cheese - â‚±38</label>
                </div>
            </div>
            <div class="quantity-selector">
                <label for="burger-quantity">Quantity:</label>
                <div class="quantity-controls">
                    <button type="button" class="quantity-btn" onclick="decreaseBurgerQuantity()">-</button>
                    <input type="number" id="burger-quantity" value="1" min="1" max="10">
                    <button type="button" class="quantity-btn" onclick="increaseBurgerQuantity()">+</button>
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeBurgerModal()">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="addBurgerToCart()">Add to Cart</button>
            </div>
        </div>
    </div>    

    <footer>
        <div class="container footer-content">
            <p>&copy; 2025 FaithCafe. All rights reserved.</p>
        </div>
    </footer>

    <script src="../static/js/script.js"></script>
    <script>
        let menuItems = [];
        let currentItem = null;
        let currentRegularPrice = 0;
        let currentLargePrice = 0;

        // Load menu when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            await loadMenuItems();
            setupModalEventListeners();
        });

        async function loadMenuItems() {
            try {
                menuItems = await getMenuItems();
                renderMenu();
            } catch (error) {
                console.error('Error loading menu:', error);
                showNotification('Error loading menu', 'error');
            }
        }

        function renderMenu() {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';

            // Group items by category
            const categories = {
                'hot-coffees': { title: 'Hot Coffees', items: [] },
                'iced-coffees': { title: 'Iced Coffees', items: [] },
                'milk-tea': { title: 'Milk Tea', items: [] },
                'snacks': { title: 'Snacks', items: [] }
            };

            // Sort items into categories
            menuItems.forEach(item => {
                if (categories[item.category]) {
                    categories[item.category].items.push(item);
                }
            });

            // Render each category
            Object.entries(categories).forEach(([categoryKey, category]) => {
                if (category.items.length === 0) return;

                const categorySection = document.createElement('section');
                categorySection.className = 'menu-category';
                categorySection.innerHTML = `
                    <div class="category-header">
                        <h2 class="category-title">${category.title}</h2>
                    </div>
                    <div class="menu-grid" id="grid-${categoryKey}">
                        <!-- Items will be added here -->
                    </div>
                `;

                container.appendChild(categorySection);

                const grid = document.getElementById(`grid-${categoryKey}`);
                category.items.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'menu-item';
                    
                    let priceHTML = `â‚±${item.price.toFixed(2)}`;
                    if (item.sizes) {
                        const sizes = Object.entries(item.sizes);
                        priceHTML = sizes.map(([size, price]) => 
                            `â‚±${price} (${size.charAt(0).toUpperCase() + size.slice(1)})`
                        ).join(' â€¢ ');
                    } else if (item.options) {
                        const options = Object.entries(item.options);
                        priceHTML = options.map(([option, price]) => 
                            `â‚±${price} (${option})`
                        ).join(' â€¢ ');
                    }

                    let buttonHTML = '';
                    if (item.sizes) {
                        buttonHTML = `<button class="btn add-to-cart" onclick="showSizeModal('${item.name}', ${item.sizes.regular || item.price}, ${item.sizes.large || item.price})">Add to Cart</button>`;
                    } else if (item.options) {
                        buttonHTML = `<button class="btn add-to-cart" onclick="showBurgerModal()">Add to Cart</button>`;
                    } else {
                        buttonHTML = `<button class="btn add-to-cart" onclick="addToCart('${item.name}', ${item.price})">Add to Cart</button>`;
                    }

                    itemElement.innerHTML = `
                        <div class="item-image">
                            <img src="${item.image || '/static/images/placeholder.jpg'}" alt="${item.name}" onerror="this.src='/static/images/placeholder.jpg'">
                        </div>
                        <div class="item-details">
                            <div class="item-name">${item.name}</div>
                            <div class="item-price">${priceHTML}</div>
                            ${buttonHTML}
                        </div>
                    `;
                    
                    grid.appendChild(itemElement);
                });
            });
        }

        // Modal functionality (keep your existing modal functions)
        function showSizeModal(itemName, regularPrice, largePrice) {
            currentItem = itemName;
            currentRegularPrice = regularPrice;
            currentLargePrice = largePrice;
            
            document.getElementById('modal-item-name').textContent = itemName;
            document.getElementById('regular-price').textContent = regularPrice;
            document.getElementById('large-price').textContent = largePrice;
            document.getElementById('quantity').value = 1;
            
            document.getElementById('sizeModal').style.display = 'block';
        }

        function showBurgerModal() {
            document.getElementById('burgerModal').style.display = 'block';
            document.getElementById('burger-quantity').value = 1;
        }

        function closeModal() {
            document.getElementById('sizeModal').style.display = 'none';
        }

        // Close modals when clicking X button
        document.querySelectorAll('.close-modal').forEach(closeBtn => {
            closeBtn.addEventListener('click', function() {
                document.getElementById('sizeModal').style.display = 'none';
                document.getElementById('burgerModal').style.display = 'none';
            });
        });

        function closeBurgerModal() {
            document.getElementById('burgerModal').style.display = 'none';
        }

        function increaseQuantity() {
            const quantityInput = document.getElementById('quantity');
            if (quantityInput.value < 10) {
                quantityInput.value = parseInt(quantityInput.value) + 1;
            }
        }

        function decreaseQuantity() {
            const quantityInput = document.getElementById('quantity');
            if (quantityInput.value > 1) {
                quantityInput.value = parseInt(quantityInput.value) - 1;
            }
        }

        function increaseBurgerQuantity() {
            const quantityInput = document.getElementById('burger-quantity');
            if (quantityInput.value < 10) {
                quantityInput.value = parseInt(quantityInput.value) + 1;
            }
        }

        function decreaseBurgerQuantity() {
            const quantityInput = document.getElementById('burger-quantity');
            if (quantityInput.value > 1) {
                quantityInput.value = parseInt(quantityInput.value) - 1;
            }
        }

        function addToCartWithSize() {
            const selectedSize = document.querySelector('input[name="size"]:checked').value;
            const quantity = parseInt(document.getElementById('quantity').value);
            const price = selectedSize === 'regular' ? currentRegularPrice : currentLargePrice;
            const itemName = `${currentItem} (${selectedSize.charAt(0).toUpperCase() + selectedSize.slice(1)})`;
            
            addToCart(itemName, price, quantity);
            closeModal();
        }

        function addBurgerToCart() {
            const selectedType = document.querySelector('input[name="burger-type"]:checked').value;
            const quantity = parseInt(document.getElementById('burger-quantity').value);
            const price = selectedType === 'plain' ? 35 : 38;
            const itemName = selectedType === 'plain' ? 'Burger' : 'Burger with Cheese';
            
            addToCart(itemName, price, quantity);
            closeBurgerModal();
        }

        function setupModalEventListeners() {
            // Close modals when clicking outside
            window.onclick = function(event) {
                const sizeModal = document.getElementById('sizeModal');
                const burgerModal = document.getElementById('burgerModal');
                
                if (event.target === sizeModal) {
                    closeModal();
                }
                if (event.target === burgerModal) {
                    closeBurgerModal();
                }
            }

            // Close modals with escape key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeModal();
                    closeBurgerModal();
                }
            });
        }
    </script>
</body>
</html>